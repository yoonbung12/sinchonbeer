<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReviewMapper">

<resultMap type="com.bitcamp.sc.review.domain.ReviewVO" id="ReviewDomain">
	<result property="idx" column="ridx"/>
	<result property="title" column="rtitle"/>
	<result property="name" column="rname"/>
	<result property="contents" column="rcontents"/>
	<result property="rate" column="rrate"/>
	<result property="date" column="rdate"/>
	<result property="category" column="rcategory"/>
	<result property="likes" column="rlikes"/>
	<result property="viewcnt" column="rviewcnt"/>
</resultMap>


    <!-- 01. 게시글 작성 -->
    <insert id="insertPost"
		parameterType="com.bitcamp.sc.review.domain.ReviewVO"
		useGeneratedKeys="true"
		keyProperty="idx"
	>
        INSERT INTO project.review (ridx, rtitle, rcontents, rname) 
        VALUES ((SELECT NVL(MAX(ridx)+1, 1)FROM project.review), #{title}, #{contents}, #{name})
	</insert>

	<!--02. 게시글 상세보기 조회 -->
	<select id="viewPost"  resultMap="ReviewDomain" parameterType="Integer" >
		SELECT * FROM project.review WHERE ridx = #{idx}
	</select>
	
	<!-- 03. 게시글 수정처리 -->
	<update id="updatePost" parameterType="Integer" >
		UPDATE project.review SET rtitle = #{title}, rcontents = #{contents} WHERE ridx = #{idx}
	</update>
    
	<!-- 04. 게시글 삭제처리 -->
	<delete id="deletePost"  parameterType="Integer" >
		DELETE FROM project.review WHERE ridx = #{idx}
	</delete>
	

    <!-- 05. 게시글 전체 목록 조회 -->
    
 <!--    <select id="listAllPost" 
    	resultType="com.bitcamp.sc.review.domain.ReviewVO"
		resultMap="MemberDomain">
        SELECT 
            ridx, rtitle, rname, rcontents, rrate, rdate, rcategory, rlikes, rviewcnt 
        FROM 
            project.review
        WHERE
        	ridx=#{param1} and rname=#{param2}
        ORDER BY 
            ridx desc, rdate desc
    </select> -->
    
    <select id="listAllPost"  resultMap="ReviewDomain" >
        SELECT 
            *
        FROM 
            review
        ORDER BY 
            ridx desc, rdate desc
    </select>
    
    
    
	<!-- 06. 게시글 조회수 증가처리 -->
	<update id="increaseViewcnt">
		UPDATE review SET viewcnt = viewcnt + 1 WHERE ridx = #{idx}
	</update>
</mapper>
